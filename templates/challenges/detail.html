<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<head>
    <title>대회 상세정보 | RUN WAVE</title>

    <th:block layout:fragment="pageStyles">
        <link rel="stylesheet" th:href="@{/css/challenge-detail.css}">
        <style>
            .detail-img {
                width: 100%;
                max-height: 320px;
                object-fit: cover;
                border-radius: 12px;
            }
        </style>
    </th:block>
</head>

<body>

<div layout:fragment="content">

    <div class="mb-6">
        <a th:href="@{/challenges}" class="text-indigo-600 hover:underline">
            ← 대회 목록으로 돌아가기
        </a>
    </div>

    <!-- 대회 정보 -->
    <section class="bg-white p-6 rounded-lg shadow mb-6">
        <h1 class="text-3xl font-bold mb-4" id="title">대회 이름</h1>

        <img id="mainImage"
             src="/assets/no-image.png"
             alt="대회 이미지"
             class="detail-img mb-6"/>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

            <div>
                <p class="text-gray-600 font-semibold">위치</p>
                <p id="location" class="text-lg mb-3">—</p>
            </div>

            <div>
                <p class="text-gray-600 font-semibold">대회 기간</p>
                <p id="date" class="text-lg mb-3">—</p>
            </div>

            <div>
                <p class="text-gray-600 font-semibold">참가비</p>
                <p id="fee" class="text-lg mb-3">—</p>
            </div>

            <div>
                <p class="text-gray-600 font-semibold">조회수</p>
                <p id="views" class="text-lg mb-3">—</p>
            </div>

        </div>

        <div class="mt-6">
            <p class="text-gray-600 font-semibold mb-1">설명</p>
            <p id="description" class="leading-relaxed">—</p>
        </div>

        <!-- 신청 링크 -->
        <div id="registrationBox" class="mt-6 hidden">
            <a id="registerLink"
               href="#"
               target="_blank"
               class="inline-block bg-indigo-600 text-white px-5 py-3 rounded hover:bg-indigo-700">
                대회 신청하기
            </a>
        </div>

    </section>

    <!-- 지도 이미지 -->
    <section class="bg-white p-6 rounded-lg shadow">
        <h2 class="text-2xl font-bold mb-4">코스 지도</h2>

        <img id="mapFile"
             src="/assets/no-image.png"
             alt="코스 지도 이미지"
             class="detail-img">
    </section>

</div>

<!-- JS -->
<th:block layout:fragment="pageScripts">

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const challengeId = [[${challengeId}]];

            fetch(`/api/challenges/${challengeId}`)
                .then(res => res.json())
                .then(data => {
                    document.getElementById("title").textContent = data.title;
                    document.getElementById("location").textContent = data.location || "장소 미정";
                    document.getElementById("date").textContent =
                        `${data.startDate.substring(0,10)} ~ ${data.endDate.substring(0,10)}`;
                    document.getElementById("fee").textContent =
                        data.fee ? data.fee + "원" : "무료";
                    document.getElementById("description").textContent = data.description || "";
                    document.getElementById("views").textContent = data.views;

                    // 대표 이미지
                    document.getElementById("mainImage").src =
                        data.imageUrl || "/assets/no-image.png";

                    // 지도 이미지
                    if (data.mapFile) {
                        document.getElementById("mapFile").src = "/uploads/maps_dir/" + data.mapFile;
                    }

                    // 신청 링크
                    if (data.registrationLink) {
                        const btn = document.getElementById("registrationBox");
                        btn.classList.remove("hidden");
                        document.getElementById("registerLink").href = data.registrationLink;
                    }
                });
        });
    </script>

</th:block>

</body>
</html>
